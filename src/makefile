#==================================================================================================#
#  MAIN MAKEFILE
#==================================================================================================#
#
#--------------------------------------------------------------------------------------------------#
include ../makefile.defs
#--------------------------------------------------------------------------------------------------#
INFO_COMPILING=\e[1;34m[COMPILING]\e[0m
INFO_LINKING=\e[1;34m[LINKING]\e[0m
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
SRC = $(shell cat sources.mk)
OBJ = $(SRC:.f90=.o)
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
all: main
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
main:
	@printf "%`tput cols`s\n"|tr ' ' '-'
	@printf "COMPILING MAIN CODE...\n"
	@printf "%`tput cols`s\n"|tr ' ' '-'
	@$(MAKE) -j -s $(MAIN_LIB)
	@printf "%`tput cols`s\n"|tr ' ' '-'
	@printf "$(INFO_COMPILING)   $(FC) -c main.f90 -o main.o\n";
	@$(FC) $(FCFLAGS) $(INCDIRS) -c main.f90 -o main.o
	@printf "%`tput cols`s\n"|tr ' ' '-'
	@printf "LINKING MAIN CODE...\n"
	@printf "%`tput cols`s\n"|tr ' ' '-'
	@printf "$(INFO_LINKING)     $(FC) main.o $(MAIN_LIB) -o ../bin/main\n";
	@$(FC) $(FLFLAGS) main.o $(MAIN_LIB) -o ../bin/main $(ALLLIBS)
	@printf "%`tput cols`s\n"|tr ' ' '-'
	@printf "COMPILING AND LINKING MAIN CODE...DONE!\n"
	@printf "%`tput cols`s\n"|tr ' ' '-'
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
$(MAIN_LIB): $(OBJ)
	$(AR) $(AR_FLAGS) $(MAIN_LIB) $(OBJ)
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
%.o: %.f90
	@printf "$(INFO_COMPILING)   $(FC) $<\n";
	@$(FC) $(FCFLAGS) $(INCDIRS) -c $< -o $@
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
clean:
	@rm -f $(OBJ) *.mod main.o *.i
	@rm -f $(MAIN_LIB)
	@rm -f ../myhostfile
	@rm -f ../bin/main
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
veryclean: clean
	@printf "%`tput cols`s"|tr ' ' '-'
	@printf "CLEANING UP SHARED LIBRARIES...\n"
	@printf "%`tput cols`s"|tr ' ' '-'
	@cd ../ext && $(MAKE) clean
#--------------------------------------------------------------------------------------------------#
#
#---------------------------------------------------------------------------------------------------
# DEPENDENCIES
#---------------------------------------------------------------------------------------------------
-include deplist.mk
#--------------------------------------------------------------------------------------------------#
#
#---------------------------------------------------------------------------------------------------
# UTILITY TARGETS
#---------------------------------------------------------------------------------------------------
.PHONY: all main shared clean veryclean
#--------------------------------------------------------------------------------------------------#
