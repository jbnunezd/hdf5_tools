#--------------------------------------------------------------------------------------------------#
include ../makefile.defs
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
ifeq ($(BUILD_HDF5),T)
all: dir hdf5
else
all:
endif
#--------------------------------------------------------------------------------------------------#
ifeq ($(MPI),T)
HDF5_CONFIGURE= --enable-fortran --enable-parallel --disable-shared
else
HDF5_CONFIGURE= --enable-fortran --disable-shared
endif
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
HDF5_PAGE="https://support.hdfgroup.org/ftp/HDF5/releases"
HDF5_SUBD="hdf5-$(HDF5_MAJORVERSION).$(HDF5_MINORVERSION)/hdf5-$(HDF5_VERSION)/src"
HDF5_FILE="hdf5-$(HDF5_VERSION).tar.gz"
HDF5_LINK=$(HDF5_PAGE)/$(HDF5_SUBD)/$(HDF5_FILE)
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
dir:
	@ if [ ! -d $(SHARECOMP)/ ] ; then \
		mkdir $(SHARECOMP)/ ; \
	fi
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
hdf5:
	@if [ -n "$(HDF5_VERSION)" ] && [ ! -f $(SHARECOMP)/hdf5-$(HDF5_VERSION)/hdf5/lib/libhdf5.a ] ; then \
		printf "%`tput cols`s"|tr ' ' '-' ; \
		printf "COMPILING HDF5 LIBRARY...\n" ; \
		printf "%`tput cols`s"|tr ' ' '-' ; \
		echo ; \
		if [ ! -f hdf5-$(HDF5_VERSION).tar.gz ] ; then \
			wget -N $(HDF5_LINK);\
		fi ; \
		if [ ! -d $(SHARECOMP)/hdf5-$(HDF5_VERSION) ] ; then \
			cd $(SHARECOMP)/ && tar -xvf ../hdf5-$(HDF5_VERSION).tar.gz 1>/dev/null && cd .. ; \
		fi ; \
		cd $(SHARECOMP)/hdf5-$(HDF5_VERSION) && CC='$(CC)' FC='$(FC)' CXX='$(CXX)' ./configure $(HDF5_CONFIGURE) && $(MAKE) -j && $(MAKE) install ; \
		printf "%`tput cols`s"|tr ' ' '-' ;\
		printf "COMPILING HDF5 LIBRARY... DONE!\n" ; \
		printf "%`tput cols`s"|tr ' ' '-' ;\
	fi
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
clean:  
	@rm -f *~
	@ if [ -d $(SHARECOMP)/hdf5-$(HDF5_VERSION) ] ; then \
		cd $(SHARECOMP)/hdf5-$(HDF5_VERSION) && $(MAKE) clean && $(MAKE) uninstall ; \
	fi
#--------------------------------------------------------------------------------------------------#
#
#--------------------------------------------------------------------------------------------------#
# Utility Targets
#--------------------------------------------------------------------------------------------------#
.PHONY: all shared_banner hdf5 dir clean
#--------------------------------------------------------------------------------------------------#
