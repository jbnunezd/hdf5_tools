#--------------------------------------------------------------------------------------------------#
# Enable MPI
#--------------------------------------------------------------------------------------------------#
IF(MAIN_ENABLE_MPI)
  FIND_PACKAGE(MPI REQUIRED)
  IF (NOT MPI_Fortran_NO_INTERROGATE)
    FOREACH(DIR ${MPI_INCLUDE_PATH})
      INCLUDE_DIRECTORIES(${DIR})
    ENDFOREACH()
    FOREACH(DIR ${MPI_Fortran_INCLUDE_PATH})
      INCLUDE_DIRECTORIES(${DIR})
    ENDFOREACH()
    LIST(APPEND LINKEDLIBS ${MPI_Fortran_LIBRARIES})
  ENDIF()
  MARK_AS_ADVANCED(MPI_LIBRARY MPI_EXTRA_LIBRARY)
  MESSAGE(STATUS "Building MAIN with MPI")
  MESSAGE(STATUS "MPI Compiler: " ${MPI_Fortran_COMPILER})
  ADD_DEFINITIONS(-DMPI=1)
  SET(MAIN_FC  ${MPI_Fortran_COMPILER})
  SET(MAIN_CC  ${MPI_C_COMPILER})
  SET(MAIN_CXX ${MPI_CXX_COMPILER})
  SET(MAIN_EXTERNAL_LIB_SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/ext)
  SET(MAIN_EXTERNAL_LIB_DIR ${CMAKE_CURRENT_SOURCE_DIR}/ext/${CMAKE_Fortran_COMPILER_ID}-PARALLEL)
ELSE()
  ADD_DEFINITIONS(-DMPI=0)
  SET(MAIN_FC  ${CMAKE_Fortran_COMPILER})
  SET(MAIN_CC  ${CMAKE_C_COMPILER})
  SET(MAIN_CXX ${CMAKE_CXX_COMPILER})
  SET(MAIN_EXTERNAL_LIB_SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/ext)
  SET(MAIN_EXTERNAL_LIB_DIR ${CMAKE_CURRENT_SOURCE_DIR}/ext/${CMAKE_Fortran_COMPILER_ID}-SERIAL)
ENDIF()
MARK_AS_ADVANCED(MAIN_EXTERNAL_LIB_DIR)
#--------------------------------------------------------------------------------------------------#
